最終更新: 2025-08-16 JST

## 本書の目的

本書は、開発エージェント（Codex 等）が従う運用方針を明文化したものです。特に「人の承認を挟まず、作業完了後に自動で git push する」ことを原則とします。

## 出力スタイル

応答は日本語のです・ます調を基本とします。必要に応じて呼称は「ゆうすけ様」または「マスター」を用い、見出しは最小限とし、箇条書きは必要時のみ使用します。専門用語は簡潔に補足します。

## 動作原則（無承認の自動プッシュ）

作業単位のタスクが完了したら、承認を求めずに次の順で実行します。

1. フォーマットと静的解析を実施します（例: Prettier / ESLint / ruff / black 等）。
2. テストが定義されている場合は実行し、失敗時は中断して理由を出力します。
3. `git add -A` を行い、規約に沿ったコミットメッセージで `git commit` を行います。
4. `git push` を実行します。リモートは原則 `origin`、対象は「現在のローカルブランチ」です。upstream が未設定なら `--set-upstream origin <branch>` を用いて設定します。
5. 失敗や競合がある場合は中断し、標準出力に原因と次の一手を簡潔に提示します。

## 重要方針

直 push を前提とします。Pull Request は原則作成しません。強制 push（--force / --force-with-lease）は明示指示が無い限り禁止です。巨大な破壊的変更や既知の保護ブランチ運用がある場合でも、原則は現在ブランチへの直接 push です。

## セキュリティと安全ガード

秘密情報の混入や事故を防ぐため、push 前に以下を自動チェックします。  
・秘密情報検出: API キー、トークン、証明書、.env 類似ファイル、鍵素材を検出した場合は中断し、パスと疑義パターンを出力します。  
・巨大差分検出: 追加・削除の合計が既定閾値（例: 5,000 行）を超える場合は中断し、範囲を要約します。  
・危険パス検出: `node_modules` や `dist`、ビルド生成物、バイナリ大容量ファイル（>10MB）は原則コミットしません。必要時は明示指示を要します。  
・破壊的操作禁止: DB 初期化、システム領域の削除、権限エスカレーション等は提案・実行しません。

## コミットメッセージ規約

Conventional Commits に準拠します。  
`feat|fix|docs|chore|refactor|test|perf: 要約` の形式とし、必要に応じて `(#issue)` を末尾に付与します。本文では動機と影響範囲を一段落で記載します。ブレーク変更は `BREAKING CHANGE:` をフッターに記載します。

## 既定の除外と生成物

`.gitignore` に準拠します。ビルド生成物、キャッシュ、ログ、ローカル設定はコミット対象外です。ドキュメント生成やコード生成を行った場合は、ソース（スクリプトや設定）を優先してバージョン管理します。

## ログと監査

各タスクの実行ログを `.codex/logs/` 配下に保存し、タイムスタンプ、現在ブランチ、最新コミットハッシュ、差分要約、テスト結果、push 結果を記録します。失敗時は原因と再実行コマンド例を併記します。

## 環境と基本コマンド（例）

Node 22 / Python 3.11 を標準とします。セットアップは `npm ci`、テストは `npm test`、開発実行は `npm run dev` を既定とします。言語やツールチェーンが異なる場合は各プロジェクトの README を優先します。

## 運用例

小さな修正を行った場合、上記の順でフォーマット→テスト→コミット→自動プッシュまでを一気通貫で実行します。レビューが不要な運用を前提とするため、変更は小さく分割し、コミットを高頻度・低リスクに保ちます。

## 例外と明示指示

外部規約や法的制約により直 push が不適切な場合のみ、担当者の明示指示で例外運用を許可します。例外時は理由と期間をログへ明記します。
