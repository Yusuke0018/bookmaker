<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0F172A" />
    <title>ブックメイカー（却本作り）</title>
    <meta
      name="description"
      content="最小入力で学びを蓄積し、楽しく振り返る読書ログ"
    />
    <link rel="manifest" href="./manifest.json" />
    <link rel="icon" href="./icons/icon-192.png" />
    <link rel="apple-touch-icon" href="./icons/icon-192.png" />
    <link rel="stylesheet" href="./assets/style.css" />
  </head>
  <body>
    <header class="app-header">
      <h1 class="brand">ブックメイカー</h1>
      <nav class="tabs" role="tablist" aria-label="ナビゲーション">
        <a href="#home" id="tab-home" class="tab active">ホーム</a>
        <a href="#calendar" id="tab-calendar" class="tab">カレンダー</a>
        <a href="#add" id="tab-add" class="tab">追加</a>
        <a href="#achievements" id="tab-achievements" class="tab">実績</a>
        <a href="#settings" id="tab-settings" class="tab">設定</a>
      </nav>
    </header>

    <main id="main" class="container">
      <section id="view-home" class="view active" aria-labelledby="tab-home">
        <div class="card">
          <label for="q" class="label">検索</label>
          <input
            id="q"
            class="input"
            type="search"
            placeholder="タイトル・著者・感想で検索"
          />
        </div>

        <div class="card" id="reunion-card" hidden>
          <h2 class="h2">今日の再会本</h2>
          <div id="reunion"></div>
        </div>

        <div class="card" id="quote-card">
          <h2 class="h2">今日の名言</h2>
          <div id="quote"></div>
        </div>

        <div class="card">
          <h2 class="h2">最近の読了</h2>
          <ul id="recent-list" class="list"></ul>
        </div>

        <div class="card">
          <h2 class="h2">バックアップと復元</h2>
          <div class="row gap">
            <button id="btn-export" class="btn">エクスポート(JSON)</button>
            <button id="btn-import" class="btn">インポート(JSON)</button>
            <input
              id="file-import"
              type="file"
              accept="application/json"
              hidden
            />
          </div>
        </div>
      </section>

      <section id="view-calendar" class="view" aria-labelledby="tab-calendar">
        <div class="card">
          <div
            class="row gap"
            style="
              justify-content: space-between;
              align-items: center;
              margin-bottom: 8px;
            "
          >
            <div class="row gap">
              <button id="cal-prev" class="btn small">◀︎</button>
              <div id="cal-label" class="h2"></div>
              <button id="cal-next" class="btn small">▶︎</button>
            </div>
            <div class="row gap">
              <button id="mode-month" class="btn small" aria-pressed="true">
                月
              </button>
              <button id="mode-week" class="btn small" aria-pressed="false">
                週
              </button>
              <button id="mode-year" class="btn small" aria-pressed="false">
                年
              </button>
            </div>
          </div>
          <div id="cal-summary" class="muted" style="margin-bottom: 8px"></div>
          <div id="cal-month" class="cal-month">
            <div
              class="cal-grid"
              id="cal-grid"
              aria-label="月ヒートマップ"
            ></div>
            <div id="cal-day-list" class="card" style="margin-top: 12px">
              <div class="h2">選択日の読了一覧</div>
              <ul class="list" id="cal-day-ul"></ul>
            </div>
          </div>
          <div id="cal-week" class="cal-week" hidden>
            <ul class="list" id="cal-week-ul"></ul>
          </div>
          <div id="cal-year" class="cal-year" hidden>
            <div
              class="bar-grid"
              id="year-bars"
              aria-label="年次棒グラフ"
            ></div>
          </div>
        </div>
      </section>

      <section id="view-add" class="view" aria-labelledby="tab-add">
        <form id="book-form" class="card" autocomplete="off">
          <h2 class="h2">新規作成</h2>
          <div class="grid">
            <label class="label"
              >タイトル<span class="req">必須</span>
              <input name="title" class="input" required />
            </label>
            <label class="label"
              >著者<span class="req">必須</span>
              <input name="author" class="input" required />
            </label>
            <label class="label"
              >開始日
              <input name="startedAt" class="input" type="date" />
            </label>
            <label class="label"
              >読了日
              <input name="finishedAt" class="input" type="date" />
            </label>
            <label class="label"
              >一言まとめ（20字）
              <input name="oneLiner" class="input" maxlength="20" />
            </label>
            <label class="label"
              >★評価（0–5）
              <input
                name="rating"
                class="input"
                type="number"
                min="0"
                max="5"
                step="1"
              />
            </label>
            <label class="label"
              >感想
              <textarea
                name="reviewText"
                class="textarea"
                rows="5"
                placeholder="感じたことやメモ"
              ></textarea>
            </label>
          </div>
          <div class="row gap">
            <button type="submit" class="btn primary">保存</button>
            <button type="button" id="save-continue" class="btn">
              保存して続ける
            </button>
            <button type="button" id="mark-finished-today" class="btn">
              今日で読了
            </button>
          </div>
        </form>
      </section>

      <section
        id="view-achievements"
        class="view"
        aria-labelledby="tab-achievements"
      >
        <div class="card">
          <div
            class="row gap"
            style="
              justify-content: space-between;
              align-items: center;
              margin-bottom: 8px;
            "
          >
            <h2 class="h2">実績</h2>
            <button id="reload-ach" class="btn small">再読み込み</button>
          </div>

          <div id="ach-list" class="ach-grid"></div>
        </div>
      </section>

      <section id="view-settings" class="view" aria-labelledby="tab-settings">
        <form id="settings-form" class="card">
          <h2 class="h2">設定</h2>
          <div class="grid">
            <label class="label"
              >テーマ
              <select name="theme" class="input">
                <option value="auto">自動</option>
                <option value="light">ライト</option>
                <option value="dark">ダーク</option>
              </select>
            </label>
            <label class="label"
              >週の始まり
              <select name="startOfWeek" class="input">
                <option value="mon">月曜</option>
                <option value="sun">日曜</option>
              </select>
            </label>
            <label class="label"
              >演出の音
              <select name="sound" class="input">
                <option value="false">オフ</option>
                <option value="true">オン</option>
              </select>
            </label>
          </div>
          <div class="row gap" style="margin-top: 8px">
            <button type="submit" class="btn primary">保存</button>
            <button type="button" id="btn-clear-cache" class="btn">
              キャッシュ削除
            </button>
          </div>
        </form>
      </section>
    </main>

    <div id="toast" role="status" class="toast" hidden></div>

    <div id="modal" class="modal" hidden>
      <div class="modal-backdrop" id="modal-backdrop"></div>
      <div
        class="modal-content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
      >
        <div
          class="row gap"
          style="
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
          "
        >
          <h2 id="modal-title" class="h2">詳細</h2>
          <div class="row gap">
            <button id="modal-edit" class="btn small">編集</button>
            <button id="modal-close" class="btn small outline">閉じる</button>
          </div>
        </div>
        <div id="modal-body"></div>
      </div>
    </div>

    <script src="./assets/app.js" type="module"></script>
    <script src="./assets/achievements.js" type="module"></script>
    <script src="./assets/ui.js" type="module"></script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("./sw.js").catch(() => {});
        });
      }
    </script>
  </body>
</html>
